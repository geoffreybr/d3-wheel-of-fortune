d3.wheel=function(){function t(t){t.each(function(t){var s=Math.min(e,r)/2,u=s-20,d=d3.select(this);d.classed({"d3-wheel":!0}).attr("width",e).attr("height",r);var f=d.select(".main");f.empty()&&(f=d.append("g").classed({main:!0})),f.attr("transform","translate("+e/2+","+r/2+")");var p=f.select(".background");p.empty()&&(p=f.append("g").classed({background:!0})),p.append("circle").attr("cx",0).attr("cy",0).attr("r",s-10).style("fill",i);var h=d3.svg.arc().outerRadius(u).innerRadius(c),g=d3.svg.arc().outerRadius(u).innerRadius(c+4*(u-c)/5),m=d3.svg.arc().outerRadius(u).innerRadius(c-(u-c)/5),v=d3.layout.pie().sort(null).value(function(t){return 1}),y=f.select(".arc-group");y.empty()&&(y=f.append("g").classed({"arc-group":!0}));var x=y.selectAll(".arc").data(v(t)),k=x.enter().append("g").classed({arc:!0});k.append("path").classed({"arc-color":!0}).attr("d",h).style("fill",function(t){return t.data.color}),k.append("path").attr("d",g).style("fill","rgba(0, 0, 0, 0.2)");var R=s/2.4;k.append("image").attr("xlink:href",function(t){return t.data.image||""}).attr("width",R).attr("height",R).attr("transform",function(t){var e=m.centroid(t);return e[0]-=R/2,e[1]-=R/2,"translate("+e+")"});var w=function(t,e){var r=y;e!==!1&&(r=r.transition().duration(l)),r.attr("transform","rotate("+-t+")"),r=y.selectAll("image"),e!==!1&&(r=r.transition().duration(l)),r.attr("transform",function(e){var r=m.centroid(e),a=[];return a[0]=-R/2,a[1]=-R/2,"translate("+r+") rotate("+t+") translate("+a+")"})},A=function(){x.selectAll(".arc-color").transition().duration(300).style("fill",function(t){return t.data.color}),x.selectAll("image").attr("xlink:href",function(t){return t.data.image||""})};n&&w(n,!1);var M=null;x.append("path").attr("d",h).style({stroke:"#fff","stroke-width":"3px",fill:"transparent",cursor:"pointer"}).on("mouseover",function(t){d3.select(this).style("fill","rgba(255,255,255,0.2)"),o.mouseover(t.data||null)}).on("mouseout",function(t){d3.select(this).style("fill","transparent"),o.mouseout(t.data||null)}).on("click",function(t){d3.select(this).style("fill","transparent");var e=(t.startAngle+t.endAngle)/2;e*=360/(2*Math.PI),e-=a,w(e),M&&clearTimeout(M),M=setTimeout(function(){M=null,o.select(t.data||null),A()},l)});var b=f.select("selector");b.empty()&&(b=f.append("g").classed({selector:!0}),b.append("path").attr("d","M0 "+-.9*s+" L"+s/20+" "+(-s+2)+" L-"+s/20+" "+(-s+2)+" Z").attr("transform","rotate("+a+" 0 0)").style({fill:"#000",stroke:"#fff","stroke-width":"2px"}));var T=f.select(".axle");T.empty()&&(T=f.append("g").classed({axle:!0})),T.append("circle").attr("cx",0).attr("cy",0).attr("r",c-1).style("fill","#ccc"),T.append("circle").attr("cx",0).attr("cy",0).attr("r",c-15).style("fill","#eee"),T.append("circle").attr("cx",0).attr("cy",0).attr("r",c-30).style("fill",i)})}var e=500,r=500,a=0,n=0,l=700,i="#333",c=0,o=d3.dispatch("select","mouseover","mouseout");return t.width=function(r){return arguments.length?(e=r,t):e},t.height=function(e){return arguments.length?(r=e,t):r},t.selectorPosition=function(e){return arguments.length?(a=e%360,t):a},t.defaultRotation=function(e){return arguments.length?(n=e%360,t):n},t.rotationTimeMS=function(e){return arguments.length?(l=Math.max(e,0),t):l},t.color=function(e){return arguments.length?(i=e,t):i},t.innerRadius=function(e){return arguments.length?(c=e,t):c},t.on=function(t,e){o.on(t,e)},t};